workspaces:
  - name: executor
    port_forward_rules:
      - local: '9092'
        remote:
          target: cache
          port: grpc
    checkouts:
      - path: nativelink
        repo:
          # TODO update url
          git: https://github.com/pigfall/crafting-bazel-remote-demo.git
        # TODO update branch
        version_spec: tzz/sandbox-template
        manifest:
          overlays:
            - content: |
                daemons: 
                  nativelink:
                    run:
                      cmd: nativelink executors/nativelink/config.json
                hooks:
                  post-checkout:
                    cmd: |
                            [[ -x /usr/local/bin/nativelink ]] || {
                            # TODO update download url.
                            sudo wget -O /usr/local/bin/nativelink https://github.com/pigfall/nativelink/releases/download/v0.3.0/nativelink
                            sudo chmod a+rx /usr/local/bin/nativelink
                            }
containers:
  - name: cache
    image: quay.io/bazel-remote/bazel-remote:v2.4.3
    args:
      - --max_size
      - '5'
    ports:
      - name: grpc
        port: 9092
        protocol: GRPC/TCP